import React, { useState } from 'react';
import { FileText, X } from 'lucide-react';
import ReactMarkdown from 'react-markdown';
import { useLocation } from 'react-router-dom';

const DOCS_MAP: Record<string, string> = {
    '/admin': `
## 运营中心 (Dashboard)
**路径**: \`/admin\`

---

### 一、功能概述

运营中心是 Admin 端的首页，展示核心经营指标、待处理事项及全局销售数据可视化，是运营人员的每日工作台。

---

### 二、页面结构

**1. 核心指标 (The Pulse)**：
- **累计营收 (GMV)**：平台历史总销售额
- **订单总量**：累计订单笔数
- **内容转化率**：来自灵感社区的订单占比
- **高级会员**：主理人及以上等级会员数

**2. 待办事项 (The Workbench)**：
- **待发货订单**：状态为 \`pending_shipment\` 的订单（红点提示）
- **内容待审**：由于 Mock 数据限制，展示帖子总数（红点提示）
- **库存预警**：库存 < 10 的上架商品
- **退款申请**：状态为 \`refunded\` 的订单

**3. 经营洞察 (Insights)**：
- **人群销售分布**：展示四种身份（单身/情侣/家庭/三代）的消费贡献占比条形图
- **实时数据**：基于 Mock 订单动态计算

**4. 快捷操作 & 今日快报**：
- 快速新增商品、发放优惠券、配置首页入口
- 展示当日新增数据概览

---

### 三、交互逻辑

**点击卡片跳转**：
- 待办事项卡片 → 跳转对应管理页（如 \`/admin/orders\`, \`/admin/products\`）
- 快捷操作按钮 → 跳转对应功能页

**数据实时计算**：
- 所有指标均基于 \`useMockData()\` 上下文实时聚合计算
- 页面加载时无延迟，数据变化实时反映

---

### 四、页面状态

**有数据**：显示正常的数字、图表和进度条。

**无数据**：
- 核心指标显示为 0
- 待办事项显示无红点
- 销售分布显示"暂无订单数据"

---

> ⚠️ 数据来源于前端模拟，刷新页面会重新生成随机数据。
`,
    '/app/home': `
## 首页 (Home)
**路径**: \`/app/home\`

---

### 一、功能概述

动态场景化首页，根据用户选择的"生活身份"动态重组导航Tab和推荐内容，实现"千人千面"的严选体验。

---

### 二、用户身份标签（Persona）

系统预设四种身份，每种身份关联不同空间：

**1. 单身贵族 (single)**
- 图标：User
- 关联空间：客厅、厨房、浴室、卧室
- 场景：独居用户，注重个人生活品质

**2. 幸福爱侣 (couple)**
- 图标：Heart
- 关联空间：客厅、卧室、厨房、浴室
- 场景：二人世界，关注浪漫与舒适

**3. 三口之家 (family)**
- 图标：Users
- 关联空间：客厅、卧室、儿童房、厨房、阳台、浴室
- 场景：有孩家庭，需要儿童专属空间

**4. 三代同堂 (three_gens)**
- 图标：Home
- 关联空间：客厅、卧室、儿童房、厨房、阳台、浴室
- 场景：多代同居，全场景覆盖

> 数据来源：\`MockDataContext.tsx\` → \`INITIAL_PERSONAS\`

---

### 三、空间分类（Space）

系统支持七种居家空间：

- **living** - 客厅（家庭公共活动）
- **bedroom** - 卧室（休息睡眠）
- **kitchen** - 厨房（烹饪餐饮）
- **workspace** - 书房（学习办公）
- **kids_room** - 儿童房（儿童专属）
- **bathroom** - 浴室（洗漱卫浴）
- **balcony** - 阳台（户外休闲）

> 数据来源：\`MockDataContext.tsx\` → \`INITIAL_SPACES\`

---

### 四、页面交互逻辑

#### 4.1 顶部导航栏

**结构**：Logo + 身份切换胶囊 + 购物车图标

**身份切换胶囊**：
- 当用户点击时 → 底部弹出身份选择弹窗
- 弹窗展示所有可选身份（2x2网格）
- 当前身份高亮显示

**选择身份后**：
- 系统更新当前身份
- 关闭弹窗
- 重新渲染Tab栏
- 若当前空间不在新身份范围内 → 自动切换至第一个关联空间
- 刷新推荐商品列表

**购物车图标**：
- 点击 → 跳转 \`/app/cart\`
- 有商品时 → 右上角显示红色徽章（数量）

---

#### 4.2 空间Tab栏

**布局**：横向排列，支持左右滑动，吸顶固定

**点击Tab**：
- 高亮选中Tab（主题色+下划线）
- 按规则筛选刷新商品列表

**筛选规则**：
\`\`\`
商品.personaIds 包含 当前身份ID
且 商品.spaceIds 包含 当前空间ID
且 商品.isOnShelf = true
\`\`\`

---

#### 4.3 轮播Banner

**布局**：宽高比16:9，圆角16px，底部渐变遮罩

**当前配置**：
- 图片：\`/assets/home_banner_*.png\`
- 文案："本季新品 - Japandi Collection"

**点击**：
- 若配置了 \`linkProductId\` → 跳转商品详情
- 若未配置 → 无响应

---

#### 4.4 推荐商品瀑布流

**布局**：
- 标题："为您推荐"
- 2列网格，间距16px
- 卡片圆角12px

**商品卡片**：
- 商品图（1:1正方形）
- 商品名（单行省略）
- 价格（主题色加粗）
- 分类标签（右下角小标签）

**点击卡片** → 跳转 \`/app/product/{id}\`

---

### 五、页面状态

**初始状态**：
- 默认身份：单身贵族
- 默认空间：第一个关联空间

**有数据**：正常展示商品瀑布流

**空数据**：隐藏瀑布流，显示"该空间下暂无推荐商品"

---

### 六、身份弹窗状态

**打开状态**：
- 含义：用户正在选择身份
- 可操作：选择身份、点击取消、点击蒙层关闭
- 展示：底部白色面板 + 半透明蒙层

**关闭状态**：
- 含义：弹窗收起
- 可操作：点击胶囊按钮唤起
- 展示：弹窗和蒙层不可见

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/app/category': `
## 分类页 (Category)
**路径**: \`/app/category\`

---

### 一、功能概述

基于商品物理属性（桌、椅、床等）的导航查找页面。覆盖全量商品，不受身份标签限制。

---

### 二、页面结构

**左侧导航栏**：
- 宽度：96px
- 内容：一级类目列表（纵向排列）
- 交互：点击切换，选中项高亮+左侧色条

**右侧内容区**：
- 顶部Banner：当前类目专区图
- 下方网格：二级类目图标（3列布局）

---

### 三、一级类目配置

目前支持的一级类目：
- **tables** - 桌几类
- **sofas** - 沙发类
- **storage** - 收纳类
- **beds** - 床具类

> 数据来源：\`MockDataContext.tsx\` → \`INITIAL_CATEGORIES\`

---

### 四、二级类目配置

**桌几类 (tables)**：
- 餐桌 (dining_table)
- 茶几 (coffee_table)
- 书桌 (desk)
- 儿童家具 (kids_furniture)

**沙发类 (sofas)**：
- 真皮沙发 (leather_sofa)
- 布艺沙发 (fabric_sofa)

**收纳类 (storage)**：
- 衣柜 (wardrobe)
- 书柜 (bookshelf)
- 厨房收纳 (kitchen_storage)
- 卫浴收纳 (bath_storage)

**床具类 (beds)**：
- 双人床 (double_bed)
- 单人床 (single_bed)

---

### 五、交互逻辑

**点击左侧一级类目**：
- 高亮当前项（白色背景+左侧主题色条）
- 右侧联动更新二级类目网格

**点击右侧二级类目图标**：
- 跳转至商品列表页（待开发）
- 携带参数：\`?category={categoryId}\`

---

### 六、页面状态

**初始状态**：默认选中第一个一级类目

**有子类目**：显示二级类目网格

**无子类目**：右侧显示"暂无分类"

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/app/cart': `
## 购物车 (Cart)
**路径**: \`/app/cart\`

---

### 一、功能概述

展示用户加购商品，支持数量调整、删除、优惠券使用及模拟结算功能。

---

### 二、页面结构

**顶部导航**：返回按钮 + 标题"购物车"

**商品列表区**：
- 商品卡片（图片+名称+价格+数量控制器）
- 左滑显示删除按钮

**优惠券区**：
- 领券入口 → 跳转领券中心
- 已选优惠券展示

**底部结算栏**：
- 合计金额（含会员折扣、优惠券抵扣）
- "去结算"按钮

---

### 三、会员等级折扣

根据用户等级享受不同折扣：
- **居家新人 (resident)** → 原价
- **主理人Lv1 (manager_l1)** → 95折
- **主理人Lv2 (manager_l2)** → 9折
- **空间之神 (god)** → 8折

---

### 四、交互逻辑

**数量调整**：
- 点击"+"按钮 → 数量+1
- 点击"-"按钮 → 数量-1（最小为1）
- 数量为0时 → 自动移除该商品

**删除商品**：
- 左滑卡片 → 显示删除按钮
- 点击删除 → 从购物车移除

**使用优惠券**：
- 点击"领券"按钮 → 跳转领券中心
- 选择优惠券后自动计算抵扣金额

**去结算**：
1. 点击"去结算"按钮
2. 系统显示"支付处理中..."
3. 2秒后提示"支付成功"
4. 清空购物车
5. 跳转至个人中心页

---

### 五、价格计算逻辑

\`\`\`
原价小计 = Σ(商品单价 × 数量)
会员折后价 = 原价小计 × 会员折扣率
优惠券抵扣 = 满足门槛后的抵扣金额
实付金额 = 会员折后价 - 优惠券抵扣
\`\`\`

---

### 六、页面状态

**有商品**：正常展示商品列表+结算栏

**空购物车**：
- 显示空状态插画
- 显示"去逛逛"按钮 → 跳转首页

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/app/product': `
## 商品详情页 (PDP)
**路径**: \`/app/product/:id\`

---

### 一、功能概述

展示商品详细信息，推荐同场景搭配商品，提供加购功能。

---

### 二、页面结构

**顶部悬浮按钮**：
- 左侧：返回按钮（半透明背景）
- 右侧：分享按钮

**商品大图区**：
- 全宽高图片（400px高度）
- 支持手势缩放（待开发）

**商品信息区**：
- 标题 + 价格
- 人群标签（橙色小标签）
- 商品描述文案

**场景搭配区**：
- 标题："场景搭配"
- 横向滚动卡片列表
- 点击卡片 → 跳转对应商品详情

**底部操作栏**：
- 购物车图标（显示数量徽章）→ 跳转购物车
- "加入购物车"按钮

---

### 三、场景搭配算法

查找与当前商品具有相同属性的其他商品：

\`\`\`
筛选条件：
- personaIds 与当前商品有交集
- spaceIds 与当前商品有交集
- 排除当前商品自身
- isOnShelf = true
\`\`\`

---

### 四、交互逻辑

**点击购物车图标**：
- 跳转至 \`/app/cart\`
- 图标显示当前购物车商品数量

**点击"加入购物车"按钮**：
- 将当前商品加入购物车
- 弹出提示"已加入购物车"
- 购物车图标数字+1

**点击场景搭配卡片**：
- 跳转至对应商品详情页

---

### 五、页面状态

**商品存在**：正常展示商品信息

**商品不存在**：
- 显示"商品不存在"提示
- 提供返回按钮

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/app/inspiration': `
## 灵感社区 (Inspiration)
**路径**: \`/app/inspiration\`

---

### 一、功能概述

UGC/PGC内容社区，通过图文/视频激发购买欲望，提供"文中同款"转化链路。

---

### 二、页面结构

**顶部标题栏**：固定标题"灵感社区"

**瀑布流列表**：
- 2列网格布局
- 帖子卡片（封面+标题+作者+点赞）
- 视频帖子显示"视频"标识

**帖子详情弹窗**：
- 全屏覆盖
- 媒体轮播（图片/视频）
- 文章内容
- 文中同款商品
- 评论区

---

### 三、帖子卡片结构

- 封面图（3:4比例）
- 视频标识（左上角，仅视频帖子显示）
- 标题（最多2行）
- 作者头像+昵称
- 点赞数

---

### 四、交互逻辑

**点击帖子卡片**：
- 打开全屏详情弹窗
- 加载帖子媒体和内容

**媒体轮播**：
- 左右箭头切换
- 底部圆点指示器
- 视频自动播放（静音）

**文中同款商品**：
- 横向滚动展示关联商品
- 点击商品卡片 → 跳转商品详情页

**评论区**：
- 显示未隐藏的评论
- 官方回复高亮显示（"商家回复"标识）
- 底部评论输入框（Mock，暂不可用）

**关闭弹窗**：
- 点击右上角关闭按钮
- 返回瀑布流列表

---

### 五、数据过滤规则

- \`isHidden=true\` 的评论 → 前端不展示
- 有 \`reply\` 字段的评论 → 显示官方回复气泡
- 关联商品已下架 → 自动隐藏

---

### 六、页面状态

**有帖子**：正常展示瀑布流

**无帖子**：显示空状态（暂无内容）

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/app/profile': `
## 个人中心 (Profile)
**路径**: \`/app/profile\`

---

### 一、功能概述

用户个人信息中心，展示会员等级、订单入口及常用功能。

---

### 二、页面结构

**会员卡片区**：
- 3D翻转卡片
- 正面：头像+昵称+等级+升级进度
- 背面：当前权益详情

**订单入口**：
- 待付款 / 待发货 / 待收货 / 评价
- 点击跳转对应状态的订单列表

**功能菜单**：
- 发布笔记
- 我的收藏
- 意见反馈

---

### 三、会员等级体系

**居家新人 (resident)**：
- 累计消费 < ¥500
- 无折扣

**主理人Lv1 (manager_l1)**：
- 累计消费 ≥ ¥500
- 享受95折

**主理人Lv2 (manager_l2)**：
- 年消费 ≥ ¥1000
- 享受9折

**空间之神 (god)**：
- 年消费 ≥ ¥2000
- 享受8折

---

### 四、卡片翻转交互

**点击会员卡片**：
- 触发3D翻转动画
- 正面 ↔ 背面切换

**正面显示**：
- 用户信息
- 升级进度条
- 距离下一等级所需金额

**背面显示**：
- 当前购物折扣
- 会员有效期

---

### 五、订单入口

**四个快捷入口**：
- 待付款 → \`/app/orders?status=unpaid\`
- 待发货 → \`/app/orders?status=pending_shipment\`
- 待收货 → \`/app/orders?status=shipped\`
- 评价 → \`/app/orders?status=completed\`

**"全部"按钮**：
- 跳转 \`/app/orders\`（不带状态参数）

---

### 六、功能菜单

**发布笔记**：
- 点击 → 弹出标题输入框
- 输入后 → 模拟发布成功提示

**我的收藏**：
- 点击 → 暂无功能（待开发）

**意见反馈**：
- 点击 → 弹出反馈输入弹窗
- 提交后 → 显示"感谢您的反馈"

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/app/orders': `
## 我的订单 (OrderList)
**路径**: \`/app/orders\`

---

### 一、功能概述

订单列表页，支持按状态筛选订单，提供付款、确认收货等操作入口。

---

### 二、页面结构

**顶部导航**：返回按钮 + 标题"我的订单"

**状态Tab栏**：
- 全部 / 待付款 / 待发货 / 待收货 / 评价
- 支持URL参数 \`?status=xxx\` 定位

**订单卡片列表**：
- 订单号 + 状态标签
- 商品缩略信息
- 合计金额
- 操作按钮

---

### 三、订单状态说明

**待付款 (unpaid)**：
- 含义：订单已创建，未完成支付
- 可操作：立即付款
- 展示：显示"立即付款"按钮

**待发货 (pending_shipment)**：
- 含义：已付款，等待商家发货
- 可操作：无
- 展示：显示"等待发货"状态

**待收货 (shipped)**：
- 含义：商家已发货，等待用户收货
- 可操作：确认收货
- 展示：显示物流单号 + "确认收货"按钮

**已完成 (completed)**：
- 含义：交易完成
- 可操作：再次购买、评价（待开发）
- 展示：显示"再次购买"按钮

**已退款 (refunded)**：
- 含义：订单已退款
- 可操作：无
- 展示：灰色状态标签

---

### 四、交互逻辑

**Tab切换**：
- 点击Tab → 筛选对应状态订单
- URL同步更新参数

**立即付款**：
- 点击 → 订单状态变为"待发货"
- 弹出"支付成功"提示

**确认收货**：
- 点击 → 订单状态变为"已完成"
- 弹出"已确认收货"提示

**点击订单卡片**：
- 跳转订单详情页 \`/app/order/{orderId}\`

---

### 五、页面状态

**有订单**：正常展示订单列表

**无订单**：显示空状态插画

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/app/order': `
## 订单详情 (OrderDetail)
**路径**: \`/app/order/:id\`

---

### 一、功能概述

展示单个订单的详细信息，包括物流、商品、金额明细。

---

### 二、页面结构

**顶部状态区**（主题色背景）：
- 订单状态大标题
- 状态描述副文案

**物流信息卡片**：
- 仅"已发货/已完成"状态显示
- 最新物流动态

**收货地址卡片**：
- 收货人 + 电话
- 详细地址

**商品信息卡片**：
- 店铺名称
- 商品列表（图片+名称+规格+单价+数量）
- 价格明细（商品总价+运费+实付）

**订单信息卡片**：
- 订单编号（支持复制）
- 创建时间

**底部操作栏**：
- 联系客服按钮
- 状态相关操作按钮

---

### 三、状态与操作按钮

**待付款**：
- 状态文案："等待买家付款"
- 副文案："剩23小时59分自动关闭"
- 操作按钮："立即付款"

**待发货**：
- 状态文案："等待卖家发货"
- 副文案："感谢您的信任与支持"
- 操作按钮：无

**已发货**：
- 状态文案："卖家已发货"
- 副文案："您的包裹正在飞奔向您"
- 操作按钮："再次购买"

**已完成**：
- 状态文案："交易成功"
- 副文案："感谢您的信任与支持"
- 操作按钮："再次购买"

**已退款**：
- 状态文案："退款成功"
- 副文案："感谢您的信任与支持"
- 操作按钮：无

---

### 四、交互逻辑

**复制订单号**：
- 点击复制图标 → 弹出"已复制"提示

**联系客服**：
- 点击 → 暂无功能（待开发）

**立即付款**：
- 点击 → 跳转支付流程（Mock）

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/app/coupons': `
## 领券中心 (CouponCenter)
**路径**: \`/app/coupons\`

---

### 一、功能概述

展示可领取的优惠券，支持领取并在购物车中使用。

---

### 二、页面结构

**顶部导航**：返回按钮 + 标题"领券中心"

**优惠券列表**：
- 优惠券卡片（金额+名称+使用条件）
- 领取按钮

---

### 三、优惠券类型

**现金券 (cash_off)**：
- 展示："¥{value}"
- 示例：满100减20

**折扣券 (percent_off)**：
- 展示："{value*10}折"
- 示例：全场9折

---

### 四、优惠券属性

- **title**：券名称
- **desc**：使用说明
- **value**：面值/折扣值
- **minSpend**：最低消费门槛
- **targetTier**：适用会员等级
- **status**：active/used/expired

---

### 五、交互逻辑

**领取优惠券**：
- 点击"领取"按钮
- 弹出"领取成功"提示
- 按钮变为"已领取"（不可再点）

**使用限制**：
- 等级限制：仅符合targetTier的用户可见/可领
- 使用门槛：结算金额需满足minSpend

---

### 六、页面状态

**有优惠券**：正常展示优惠券列表

**无优惠券**：显示空状态（暂无可领优惠券）

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/admin/tags': `
## 标签配置 (TagConfig)
**路径**: \`/admin/tags\`

---

### 一、功能概述

系统核心配置页，定义"人群身份"与"空间"的映射关系，直接影响App端首页导航结构。

---

### 二、页面结构

**人群选择区**（左侧）：
- 人群卡片列表
- 点击选中高亮

**空间关联区**（右侧）：
- 空间复选框列表
- 勾选状态实时同步

---

### 三、人群配置

**单身贵族 (single)**：
- 默认空间：客厅、厨房、浴室、卧室

**幸福爱侣 (couple)**：
- 默认空间：客厅、卧室、厨房、浴室

**三口之家 (family)**：
- 默认空间：客厅、卧室、儿童房、厨房、阳台、浴室

**三代同堂 (three_gens)**：
- 默认空间：客厅、卧室、儿童房、厨房、阳台、浴室

---

### 四、交互逻辑

**选择人群**：
- 点击人群卡片 → 高亮选中
- 右侧显示该人群的空间配置

**勾选空间**：
- 勾选 → 添加关联
- 取消勾选 → 移除关联
- 实时同步至MockDataContext

**实时联动**：
- 此处修改会实时反映在App端首页Tab栏

---

### 五、注意事项

- 每个人群至少保留1个关联空间
- 修改后无需手动保存，自动生效

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/admin/products': `
## 商品管理 (ProductManagement)
**路径**: \`/admin/products\`

---

### 一、功能概述

商品全生命周期管理，支持查询、库存调整、上下架控制。

---

### 二、页面结构

**顶部操作区**：
- 搜索框（商品名称模糊搜索）
- 类目筛选下拉框
- 新增商品按钮

**商品列表表格**：
- 图片 / 名称 / 类目 / 价格 / 库存 / 状态 / 操作

---

### 三、表格字段说明

- **图片**：商品缩略图
- **名称**：商品名称
- **类目**：所属二级类目
- **价格**：销售单价
- **库存**：可售数量（可直接编辑）
- **状态**：上架/下架开关
- **操作**：编辑按钮

---

### 四、交互逻辑

**搜索**：
- 输入关键词 → 按商品名称模糊匹配
- 实时过滤列表

**类目筛选**：
- 选择类目 → 仅显示该类目商品

**库存编辑**：
- 直接修改数值 → 失焦自动保存

**上下架开关**：
- 开启 → 商品在App端可见
- 关闭 → 商品在App端隐藏

**编辑商品**：
- 点击编辑按钮 → 弹出编辑弹窗（待开发）

---

### 五、异常处理

**下架警告**：
- 若商品参与Banner推广 → 弹出警告
- 提示："该商品正在推广中，请先下线轮播图"

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/admin/orders': `
## 订单管理 (OrderManagement)
**路径**: \`/admin/orders\`

---

### 一、功能概述

订单履约中心，监控订单状态，执行发货及售后操作。

---

### 二、页面结构

**状态Tab栏**：
- 全部 / 待发货 / 已发货 / 售后

**订单列表表格**：
- 订单号 / 商品 / 用户 / 金额 / 状态 / 操作

---

### 三、订单状态流转

\`\`\`
待付款 → 待发货 → 已发货 → 已完成
              ↓
           已退款
\`\`\`

---

### 四、Tab筛选说明

**全部**：显示所有订单

**待发货 (pending_shipment)**：
- 已付款，等待商家发货
- 可操作：发货

**已发货 (shipped)**：
- 商家已发货
- 显示物流单号

**售后 (refunded)**：
- 已退款订单
- 显示"已处理"

---

### 五、交互逻辑

**发货操作**：
1. 点击"发货"按钮
2. 弹出物流单号输入弹窗
3. 填写单号 → 点击"确认发货"
4. 订单状态变为"已发货"
5. 弹窗关闭，列表刷新

**发货校验**：
- 若物流单号为空 → 提示"请输入物流单号"

---

### 六、状态标签样式

- **待发货**：琥珀色背景
- **已发货**：绿色背景
- **售后中**：红色背景

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/admin/content': `
## 社区运营 (ContentOps)
**路径**: \`/admin/content\`

---

### 一、功能概述

UGC内容审核与评论管理，维护社区氛围。

---

### 二、页面结构

**Tab栏**：帖子审核 / 评论管理

**帖子审核区**：
- 帖子卡片网格（封面+作者+标题）
- 查看详情 / 下架按钮

**评论管理区**：
- 评论列表
- 隐藏/显示开关
- 官方回复输入框

---

### 三、帖子审核

**帖子卡片信息**：
- 封面图
- 发布日期
- 作者头像+昵称
- 标题+内容摘要

**操作按钮**：
- 查看详情 → 跳转 \`/admin/content/post/{id}\`
- 下架 → 确认后删除帖子

---

### 四、评论管理

**评论信息**：
- 用户头像+昵称
- 所属帖子
- 评论内容
- 发布时间

**隐藏评论**：
- 点击"隐藏评论" → isHidden=true
- 前台立即不可见
- 已隐藏评论显示"风险屏蔽"标识

**官方回复**：
- 输入回复内容 → 回车发送
- 保存后显示"官方回复"气泡
- 前台评论区显示"商家"标识

---

### 五、帖子详情页

**路径**: \`/admin/content/post/:id\`

**功能**：
- 查看帖子完整内容
- 预览媒体（图片/视频）
- 管理该帖子下的评论

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/admin/banners': `
## 轮播配置 (BannerManagement)
**路径**: \`/admin/banners\`

---

### 一、功能概述

管理App首页轮播图，支持人群定向展示。

---

### 二、页面结构

**Banner列表**：
- Banner卡片（图片+标题+定向人群+状态）
- 启用/禁用开关

---

### 三、Banner属性

- **image**：轮播图片URL
- **title**：Banner标题
- **targetPersona**：定向人群（all/single/family等）
- **linkProductId**：点击跳转的商品ID
- **active**：是否启用

---

### 四、人群定向说明

**全部 (all)**：所有用户可见

**单身贵族 (single)**：仅单身身份用户可见

**幸福爱侣 (couple)**：仅爱侣身份用户可见

**三口之家 (family)**：仅家庭身份用户可见

**三代同堂 (three_gens)**：仅三代同堂用户可见

---

### 五、交互逻辑

**启用/禁用开关**：
- 开启 → Banner在App端展示
- 关闭 → Banner在App端隐藏

**前台联动规则**：
- 用户处于某身份时 → 仅展示匹配该身份或"全部"的Banner

---

### 六、注意事项

- 跳转配置必须关联有效的商品ID
- 建议每个身份至少配置1个Banner

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/admin/marketing': `
## 营销活动 (MarketingOps)
**路径**: \`/admin/marketing\`

---

### 一、功能概述

优惠券管理，支持新建、编辑、发放优惠券。

---

### 二、页面结构

**优惠券列表**：
- 券信息（名称+类型+面值+门槛）
- 状态标签
- 操作按钮

---

### 三、优惠券类型

**现金券 (cash_off)**：
- 直接抵扣固定金额
- 示例：满100减20

**折扣券 (percent_off)**：
- 按比例折扣
- 示例：全场9折

---

### 四、优惠券状态

- **active**：可用（绿色）
- **used**：已使用（灰色）
- **expired**：已过期（红色）

---

### 五、交互逻辑

**新建优惠券**：
- 填写券名称、类型、面值、门槛
- 选择适用会员等级
- 保存后生效

**编辑优惠券**：
- 修改优惠券信息
- 已发放的券不可修改面值

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`,
    '/admin/users': `
## 用户管理 (UserManagement)
**路径**: \`/admin/users\`

---

### 一、功能概述

查看平台用户信息，管理用户等级和消费数据。

---

### 二、页面结构

**用户列表表格**：
- 头像 / 昵称 / 等级 / 累计消费 / 年消费 / 积分

---

### 三、等级计算规则

**居家新人 → 主理人Lv1**：
- 累计消费 ≥ ¥500

**主理人Lv1 → 主理人Lv2**：
- 年消费 ≥ ¥1000

**主理人Lv2 → 空间之神**：
- 年消费 ≥ ¥2000

---

### 四、等级权益

- **居家新人**：原价购买
- **主理人Lv1**：95折
- **主理人Lv2**：9折
- **空间之神**：8折

---

### 五、注意事项

- 等级每年重新计算
- 年消费归零后自动降级

---

> ⚠️ 以上为产品层逻辑描述，不涉及技术实现。
`
};

// Default fallback
const DEFAULT_DOC = "在此处展示该页面的功能需求说明。\\n(暂无特定文档)";

interface ReqSidebarProps {
    position?: 'fixed' | 'absolute';
}

export const ReqSidebar: React.FC<ReqSidebarProps> = ({ position = 'fixed' }) => {
    const [isOpen, setIsOpen] = useState(false);
    const location = useLocation();

    const pathname = location.pathname;
    let docContent = DOCS_MAP[pathname];

    if (!docContent) {
        // Pattern matching for dynamic routes
        if (pathname.startsWith('/app/product/')) docContent = DOCS_MAP['/app/product'];
        else if (pathname.startsWith('/app/order/')) docContent = DOCS_MAP['/app/order'];
        else if (pathname.startsWith('/admin/content/post/')) docContent = DOCS_MAP['/admin/content'];
        else if (pathname === '/' || pathname === '/app') docContent = DOCS_MAP['/app/home'];
        else docContent = DEFAULT_DOC;
    }

    const posClass = position === 'fixed' ? 'fixed' : 'absolute';

    return (
        <>
            {/* Floating Trigger */}
            <button
                onClick={() => setIsOpen(true)}
                className={`${posClass} top-24 right-0 z-50 bg-white/90 backdrop-blur-md shadow-lg border border-l-stone rounded-l-full px-3 py-2 flex items-center gap-2 text-sm font-medium text-text hover:bg-stone transition-all transform hover:translate-x-[-4px]`}
                title="需求说明"
            >
                <FileText size={18} className="text-primary" />
                <span className="hidden sm:inline">需求说明</span>
            </button>

            {/* Overlay Backdrop */}
            {isOpen && (
                <div
                    className={`${posClass} inset-0 bg-black/20 z-[60] backdrop-blur-sm`}
                    onClick={() => setIsOpen(false)}
                />
            )}

            {/* Drawer Panel */}
            <div className={`${posClass} right-0 top-0 bottom-0 ${position === 'absolute' ? 'w-full' : 'w-[500px]'} bg-white/95 backdrop-blur-xl shadow-2xl z-[70] transform transition-transform duration-300 ease-out border-l border-stone p-6 flex flex-col ${isOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                <div className="flex items-center justify-between mb-8 shrink-0">
                    <h3 className="text-xl font-bold flex items-center gap-2 text-text">
                        <span className="w-2 h-6 bg-primary rounded-full" />
                        需求说明
                    </h3>
                    <button
                        onClick={() => setIsOpen(false)}
                        className="p-2 hover:bg-stone rounded-full transition-colors"
                    >
                        <X size={20} />
                    </button>
                </div>

                <div className="flex-1 overflow-y-auto scrollbar-hide -mx-2 px-2">
                    <div className="prose prose-sm prose-stone max-w-none">
                        <div className="text-sm leading-relaxed text-gray-600 bg-background p-4 rounded-xl border border-stone">
                            <ReactMarkdown>{docContent}</ReactMarkdown>
                        </div>
                    </div>
                </div>

                <div className="mt-4 pt-6 border-t border-stone shrink-0">
                    <p className="text-xs text-gray-400">当前路径: {pathname}</p>
                </div>
            </div>
        </>
    );
};
